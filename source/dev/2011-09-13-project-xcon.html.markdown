---
title: Разработка сервиса видео-конференций
description: О том, как я создавал сервис для ведения видео-конференций.
alias: project-xcon
tags: flash, flex
date: 2011-09-13
---

Задача была собрать сервис видео-конференций (вебинары). Ничего подобного раньше не приходилось создавать.

Инструменты: Cirrus (Stratus), для сайта Rails и для клиента Flex. На момент создания, rtmp и мульткаст были лишь в java и Adobe Flash.

Это был первый опыт работы с ActionScript 3. С флешем уже приходилось работать года 4 назад. Разрабатывал казуальные мини-игры для промо-акций на AS2. Переход на третью версию занял буквально несколько дней. 

Теперь о трудностях, с которыми пришлось столкнуться.

### Flex

Документация ужасная. Хоть какое-то представление об архитектуре удалось получить из шедших с Flex примеров и [Flex De Tour](http://www.adobe.com/devnet/flex/tourdeflex.html.)
Что касается комьюнити. У меня сложилось ощущение, что всех разработчиков Flex в конце 2010 массово отправили на переквалификацию. Комьюнити почти не подает признаков жизни. 

Один flash-программист высказал мнение, что фреймворк предназначался для корпоративного сектора. Программистов обучают сертифицированные Adobe'ом тренеры. Отсюда и информационный вакуум. Похоже на правду. Ведь Enterprise еще тот отстой.

Ладно, это всё пустяки. После прочтения книжки [Flex 4 Cookbook: Real-world recipes for developing RIA](http://www.goodreads.com/book/show/7473613-flex-4-cookbook.)
Из статей, конечно, [Flex Best Practices](http://www.adobe.com/devnet/flex/articles/best_practices_pt1.html,)
[AS3 Coding Convetions](http://opensource.adobe.com/wiki/display/flexsdk/Coding+Conventions.)

Несколько советов по Flex'у:
* Как бы это глупо не звучало — используйте фреймворк для фреймворка. Обратить внимание стоит на [Robotlegs](http://www.robotlegs.org)
и [PureMVC](http://puremvc.org.)

* Если вам нужно к компоненту добавить активный элемент, например кнопку — наследуйте (extens). Если просто декоративный, тогда скины (Skins).
* Не пишите код в mxml. Это отвратительно. Для вызова классов в mxml есть тэг Declarations.
* Все цветовые настройки держите во внешнем css. Кастомные скины по возможности делать с учетом глобального chromeColor.


### Cirrus, Red5 и Flash Media Server

После создания первого прототипа оказалось, что Cirrus не пробивает NAT'ы.  Окей, перенес всё на Red5. Но у него проблемы мультикастом, точнее сказать его там вообще нет. И так мы пришли к [Flash Media Server](http://www.adobe.com/products/flashmediaserver/amazonwebservices.)


Ситуация с FMS немного лучше, чем с Flex. С низкой вероятность, но всё же ответы можно получить на [официальном форуме](http://forums.adobe.com/community/flash/flash_media_server.)

По FMS пока дам 1 совет. Используйте client.send() для передачи данных клиентам, вместо SharedObject. Доступ к SO лучше вообще запретить в через дерективу client.readAccess.


### Презентации

На текущий момент для конвертации используются SWFTools, OpenOffice и jodconverter. И пока не нашел способа аккуратной открытия pptx и docx.

### Запуск

FMS поднят через Apache. Сайт на Passanger с Nginx. OpenOffice на уровне демона. FmsConsole для мониторинга нагрузки. Всё работает.

